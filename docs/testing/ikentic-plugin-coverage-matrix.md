# Ikentic Plugin Coverage Matrix

Status legend: `passing`, `partial`, `n/a`

## OpenClaw-native scaffolding coverage

| Area         | Scenario                                                           | Given                                                                     | When                                       | Then                                                                             | Source Reference                                            | OpenClaw Test File                                                  | Status  | Notes                             |
| ------------ | ------------------------------------------------------------------ | ------------------------------------------------------------------------- | ------------------------------------------ | -------------------------------------------------------------------------------- | ----------------------------------------------------------- | ------------------------------------------------------------------- | ------- | --------------------------------- |
| Registration | Service, command, hook, route, command-option registration capture | Given the bundled IKENTIC plugin is registered against OpenClaw API stubs | When OpenClaw loads the extension          | Then commands, hooks, routes, services, and tools are all captured as registered | `extensions/openclaw-ikentic-plugin/dist/index.js`          | `extensions/openclaw-ikentic-plugin/index.register.capture.test.ts` | passing | Runtime wiring for bundled plugin |
| Registration | Missing `registerCommandOption` fallback warning                   | Given a host runtime that does not expose `registerCommandOption`         | When the plugin register path executes     | Then a compatibility warning is emitted and registration continues               | `extensions/openclaw-ikentic-plugin/dist/index.js`          | `extensions/openclaw-ikentic-plugin/index.register.capture.test.ts` | passing | Fork-compat warning path          |
| Tooling/API  | `gen-config` env merge into OpenClaw config                        | Given a user has an OpenClaw config file and IKENTIC env vars set         | When the user runs `gen-config`            | Then plugin, auth, persona, and base URL config fields are merged into the file  | `extensions/openclaw-ikentic-plugin/scripts/gen-config.mjs` | `extensions/openclaw-ikentic-plugin/gen-config.script.test.ts`      | passing | Persona/auth/base URL projection  |
| Tooling/API  | `gen-config --dry-run` non-mutating behavior                       | Given a user has an existing OpenClaw config file                         | When the user runs `gen-config --dry-run`  | Then merged JSON is printed without mutating the file on disk                    | `extensions/openclaw-ikentic-plugin/scripts/gen-config.mjs` | `extensions/openclaw-ikentic-plugin/gen-config.script.test.ts`      | passing | Confirms no write on dry-run      |
| Tooling/API  | `gen-config` idempotent path dedupe                                | Given plugin load paths already include the IKENTIC path                  | When the user runs `gen-config` repeatedly | Then the plugin load path remains deduplicated                                   | `extensions/openclaw-ikentic-plugin/scripts/gen-config.mjs` | `extensions/openclaw-ikentic-plugin/gen-config.script.test.ts`      | passing | Guards duplicate plugin paths     |

## ike-agents parity matrix

| Source Test (ike-agents)          | Capability                                          | Given                                                                   | When                                                                      | Then                                                                                                            | OpenClaw Coverage                                    | OpenClaw Test File                                                   | Status  | Notes                                                           |
| --------------------------------- | --------------------------------------------------- | ----------------------------------------------------------------------- | ------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------- | -------------------------------------------------------------------- | ------- | --------------------------------------------------------------- |
| `approvals.test.ts`               | Approvals store CRUD/TTL behavior                   | Given an approval record with a bounded TTL                             | When approval data is persisted and later re-read                         | Then valid approvals are returned and expired approvals are rejected                                            | Low-level approvals store semantics                  | `extensions/openclaw-ikentic-plugin/approvals-store.test.ts`         | passing | TTL expiration validated                                        |
| `canonical-json.test.ts`          | Canonical JSON normalization determinism            | Given logically equivalent JSON payloads with different key ordering    | When canonical JSON serialization is applied                              | Then output is deterministic, nested keys are stable, and `undefined` fields are dropped                        | Canonical JSON utility behavior                      | `extensions/openclaw-ikentic-plugin/canonical-json.test.ts`          | passing | Key order and undefined handling validated                      |
| `command-new-selection.test.ts`   | `handleCommandNew` persona selection semantics      | Given a user starts a new command with structured persona args          | When command-new persona selection parsing runs                           | Then the structured `persona` value is preferred and persisted                                                  | Direct command-new selection path                    | `extensions/openclaw-ikentic-plugin/command-new-selection.test.ts`   | passing | Structured persona argument selection validated                 |
| `command-parsing.test.ts`         | Persona arg parsing edge-cases                      | Given command args may include structured or raw persona input          | When persona parsing evaluates the argument payload                       | Then structured `values.persona` is accepted and raw string forms are ignored                                   | Parser-level argument extraction                     | `extensions/openclaw-ikentic-plugin/command-parsing.test.ts`         | passing | Structured args and raw-string ignore validated                 |
| `gen-openapi-plugin.test.ts`      | OpenAPI plugin generator output contract            | Given the source test targets an OpenAPI generator module               | When parity is checked against bundled OpenClaw IKENTIC dist              | Then coverage is marked `n/a` because that generator entrypoint is not shipped                                  | Not present in bundled OpenClaw IKENTIC dist         | _N/A_                                                                | n/a     | Source package concern; no generator entrypoint in bundled dist |
| `ike-oauth-manager.test.ts`       | OAuth manager login/exchange/refresh paths          | Given a user starts OAuth login and the token lifecycle is mocked       | When begin/complete login and refresh flows execute                       | Then tokens are stored after completion and refreshed when expired                                              | OAuth manager end-to-end mocked flow                 | `extensions/openclaw-ikentic-plugin/ike-oauth-manager.test.ts`       | passing | Begin+complete+refresh covered                                  |
| `ikentic-tool-parity.test.ts`     | Locus tool registration/schema parity               | Given the plugin tool catalog is registered                             | When tool names are enumerated                                            | Then expected ADK and Locus tool names are present                                                              | Registered tool-name parity                          | `extensions/openclaw-ikentic-plugin/ikentic-tool-parity.test.ts`     | passing | ADK + Locus tool names asserted                                 |
| `login-args.test.ts`              | `/ikelogin` completion arg parsing                  | Given a user returns from OAuth with either URL form or token form args | When login completion args are parsed                                     | Then code/state values are extracted correctly for both forms                                                   | Parser-level login completion extraction             | `extensions/openclaw-ikentic-plugin/login-args.test.ts`              | passing | URL and token formats covered                                   |
| `multi-session-isolation.test.ts` | Session isolation across workspaces/sessions        | Given multiple OpenClaw sessions exist with different persona state     | When persona resolution occurs for each session                           | Then persona state does not leak across session keys                                                            | Multi-session persona isolation + bootstrap overlays | `extensions/openclaw-ikentic-plugin/multi-session-isolation.test.ts` | passing | Distinct session persona overlays asserted                      |
| `oauth-store.test.ts`             | OAuthStore persistence and profile data semantics   | Given OAuth issuer/client/token are written to store                    | When a new store instance reads persisted data                            | Then issuer, client, and token data are preserved across instances                                              | OAuth store persistence semantics                    | `extensions/openclaw-ikentic-plugin/oauth-store.test.ts`             | passing | Issuer/client/token persistence covered                         |
| `persona-cache.test.ts`           | Persona cache read/write/TTL behavior               | Given persona bundles are generated for cache                           | When cache data is written and read back from disk                        | Then persona bundles round-trip through cache storage                                                           | Persona cache persistence semantics                  | `extensions/openclaw-ikentic-plugin/persona-cache.test.ts`           | passing | Disk round-trip covered                                         |
| `persona-policy.test.ts`          | Persona tool policy resolution rules                | Given a persona has explicit allow/deny governance for IKENTIC tools    | When governance checks run for IKENTIC and non-IKENTIC tools              | Then blocked IKENTIC tools are denied while non-IKENTIC tools bypass persona gating                             | Governance allow/deny behavior                       | `extensions/openclaw-ikentic-plugin/policy-isolation.test.ts`        | passing | Ikentic vs non-ikentic policy behavior covered                  |
| `persona-store.test.ts`           | Persona selection store persistence semantics       | Given persona selections are saved for a specific session key           | When state is reloaded after restart                                      | Then selections remain isolated per session key and persist across reloads                                      | Persona selection persistence semantics              | `extensions/openclaw-ikentic-plugin/persona-store.test.ts`           | passing | Session-key isolation + restart persistence covered             |
| `personas-from-ike.test.ts`       | Persona bundle transform from Ike API records       | Given persona records are retrieved from Ike API                        | When records are converted into OpenClaw persona bundles                  | Then default IKENTIC tool allowances and approval gates are applied                                             | Persona bundle conversion rules                      | `extensions/openclaw-ikentic-plugin/personas-from-ike.test.ts`       | passing | Default tools and approvals asserted                            |
| `policy-isolation.test.ts`        | Non-ikentic tool pass-through and scoped governance | Given persona governance is scoped to IKENTIC tools                     | When a tool call is evaluated for policy enforcement                      | Then IKENTIC restrictions apply only to IKENTIC tools and non-IKENTIC calls are allowed                         | Non-ikentic bypass + ikentic gating                  | `extensions/openclaw-ikentic-plugin/policy-isolation.test.ts`        | passing | Parity with source policy expectations                          |
| `prompt-builder.test.ts`          | Prompt construction/tool inventory behavior         | Given the source test targets prompt-builder modules                    | When parity is checked against bundled OpenClaw IKENTIC dist              | Then coverage is marked `n/a` because prompt-builder modules are not shipped                                    | Not present in bundled OpenClaw IKENTIC dist         | _N/A_                                                                | n/a     | Source package concern; no prompt module in dist                |
| `race-bootstrap.test.ts`          | `command:new` and `agent:bootstrap` race handling   | Given a user selects persona via `command:new` and bootstrap follows    | When bootstrap resolves effective persona state                           | Then bootstrap reads the persisted command-new persona selection                                                | Command-new then bootstrap overlay path              | `extensions/openclaw-ikentic-plugin/race-bootstrap.test.ts`          | passing | Persisted selection read by bootstrap validated                 |
| `retry-approvals.test.ts`         | Stable approval IDs across retries                  | Given equivalent approval requests are retried with reordered params    | When approval IDs are computed and approval is granted once               | Then ID generation remains deterministic and retry proceeds after approval                                      | Deterministic approval ids + retry allow             | `extensions/openclaw-ikentic-plugin/retry-approvals.test.ts`         | passing | Reordered params produce same approval ID                       |
| `session-store.test.ts`           | OpenClaw session store path/update/read behavior    | Given session metadata is stored in filesystem-backed state             | When updates, malformed JSON recovery, locking, and key parsing flows run | Then metadata round-trips, malformed state recovers, concurrent writes serialize, and agent IDs parse correctly | Session-store behavior suite                         | `extensions/openclaw-ikentic-plugin/session-state.test.ts`           | passing | Round-trip, malformed JSON, lock/concurrency covered            |

## Current implemented OpenClaw test files

- `extensions/openclaw-ikentic-plugin/index.register.capture.test.ts`
- `extensions/openclaw-ikentic-plugin/index.behavior.auth-governance.test.ts`
- `extensions/openclaw-ikentic-plugin/index.behavior.persona-session.test.ts`
- `extensions/openclaw-ikentic-plugin/session-state.test.ts`
- `extensions/openclaw-ikentic-plugin/gen-config.script.test.ts`
- `extensions/openclaw-ikentic-plugin/canonical-json.test.ts`
- `extensions/openclaw-ikentic-plugin/command-parsing.test.ts`
- `extensions/openclaw-ikentic-plugin/login-args.test.ts`
- `extensions/openclaw-ikentic-plugin/approvals-store.test.ts`
- `extensions/openclaw-ikentic-plugin/oauth-store.test.ts`
- `extensions/openclaw-ikentic-plugin/persona-store.test.ts`
- `extensions/openclaw-ikentic-plugin/persona-cache.test.ts`
- `extensions/openclaw-ikentic-plugin/personas-from-ike.test.ts`
- `extensions/openclaw-ikentic-plugin/policy-isolation.test.ts`
- `extensions/openclaw-ikentic-plugin/retry-approvals.test.ts`
- `extensions/openclaw-ikentic-plugin/ikentic-tool-parity.test.ts`
- `extensions/openclaw-ikentic-plugin/command-new-selection.test.ts`
- `extensions/openclaw-ikentic-plugin/multi-session-isolation.test.ts`
- `extensions/openclaw-ikentic-plugin/race-bootstrap.test.ts`
- `extensions/openclaw-ikentic-plugin/ike-oauth-manager.test.ts`
